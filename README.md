# KV Storage - Modern Key-Value Storage with HTTP API

–°–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ key-value —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Å HTTP API, –ø–æ—Å—Ç—Ä–æ–µ–Ω–Ω–æ–µ –Ω–∞ Tarantool 3.4.0 —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Go –∏ clean architecture.

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- **Clean Architecture**
- **HTTP API**
- **Connection Pooling**
- **Rate Limiting**
- **Graceful Shutdown** 
- **Soft Delete**
- **Tarantool 3.4.0**
- **Logging** 

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Go 1.21+
- Tarantool 3.4.0+
- Docker & Docker Compose (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

## –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker Compose

–°–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–± –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–µ–∫—Ç:

```bash
# 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone <repository-url>
cd kv-storage

# 2. –ó–∞–ø—É—Å—Ç–∏—Ç—å —á–µ—Ä–µ–∑ Docker Compose
docker-compose up -d

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
docker-compose ps

# 4. –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏
docker-compose logs -f
```

### –î–æ—Å—Ç—É–ø–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã:
- **KV Storage API**: http://localhost:8080
- **Swagger UI**: http://localhost:8080/swagger/index.html
- **Tarantool**: localhost:3301

### –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã Docker Compose:
```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã
docker-compose down

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
docker-compose restart

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏ —É–¥–∞–ª–∏—Ç—å volumes
docker-compose down -v

# –°–æ–±—Ä–∞—Ç—å –∑–∞–Ω–æ–≤–æ
docker-compose up --build -d
```

## üîß –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–æ–º —á–µ—Ä–µ–∑ Makefile

–ü—Ä–æ–µ–∫—Ç –≤–∫–ª—é—á–∞–µ—Ç Makefile –¥–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è:

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:
```bash
# –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
make help

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è Swagger
make install-deps

# –°–±–æ—Ä–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
make build

# –ó–∞–ø—É—Å–∫ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
make run

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
make test

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
make swagger
```

## API Endpoints

### Swagger UI
- **URL**: http://localhost:8080/swagger/index.html

### –û—Å–Ω–æ–≤–Ω—ã–µ endpoints:

#### –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏
```bash
POST /api/v1/kv
Content-Type: application/json

{
  "key": "user:123",
  "value": "{\"name\":\"John Doe\",\"email\":\"john@example.com\"}"
}
```

#### –ü–æ–ª—É—á–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏
```bash
GET /api/v1/kv/user:123
```

#### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏
```bash
PUT /api/v1/kv/user:123
Content-Type: application/json

{
  "value": "{\"name\":\"John Smith\",\"email\":\"john.smith@example.com\"}"
}
```

#### –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π

##### Hard Delete (–ø–æ–ª–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ)
```bash
DELETE /api/v1/kv/user:123
```

##### Soft Delete (–º—è–≥–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ)
```bash
DELETE /api/v1/kv/user:123
Content-Type: application/json

{
  "soft_delete": true
}
```

#### –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏
```bash
POST /api/v1/kv/user:123/restore
```

#### –°–ø–∏—Å–æ–∫ –∑–∞–ø–∏—Å–µ–π
```bash
# –û–±—ã—á–Ω—ã–π —Å–ø–∏—Å–æ–∫ (–±–µ–∑ —É–¥–∞–ª–µ–Ω–Ω—ã—Ö)
GET /api/v1/kv?limit=10&offset=0

# –°–ø–∏—Å–æ–∫ –≤–∫–ª—é—á–∞—è —É–¥–∞–ª–µ–Ω–Ω—ã–µ
GET /api/v1/kv/all?limit=10&offset=0
```

#### Health Check
```bash
GET /health
```

–°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –¥–≤–∞ —Ç–∏–ø–∞ —É–¥–∞–ª–µ–Ω–∏—è:

### Hard Delete
- –ü–æ–ª–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –∏–∑ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
- –î–∞–Ω–Ω—ã–µ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
- –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –∫—ç—à–∞ –∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

### Soft Delete
- –ó–∞–ø–∏—Å—å –ø–æ–º–µ—á–∞–µ—Ç—Å—è –∫–∞–∫ —É–¥–∞–ª–µ–Ω–Ω–∞—è
- –î–∞–Ω–Ω—ã–µ –æ—Å—Ç–∞—é—Ç—Å—è –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
- –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –≤–∞–∂–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, –∞—É–¥–∏—Ç–∞, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
kv-storage/
‚îú‚îÄ‚îÄ cmd/
‚îÇ   ‚îî‚îÄ‚îÄ main.go                 # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îî‚îÄ‚îÄ config.yaml             # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ docs/                       # Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ internal/
‚îÇ   ‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ bootstrap.go        # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ logger.go           # –õ–æ–≥–≥–µ—Ä
‚îÇ   ‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ config.go           # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ domain/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ errors.go           # –û—à–∏–±–∫–∏ –¥–æ–º–µ–Ω–∞
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ models.go           # –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ interfaces/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ logger.go           # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ª–æ–≥–≥–µ—Ä–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ repository.go       # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ router.go           # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Ä–æ—É—Ç–µ—Ä–∞
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ service.go          # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å–µ—Ä–≤–∏—Å–∞
‚îÇ   ‚îú‚îÄ‚îÄ repository/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pool.go             # Connection pooling
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ tarantool.go        # Tarantool —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ service/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ kv_service.go       # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ kv_service_test.go  # –¢–µ—Å—Ç—ã —Å–µ—Ä–≤–∏—Å–∞
‚îÇ   ‚îî‚îÄ‚îÄ transport/
‚îÇ       ‚îî‚îÄ‚îÄ http/
‚îÇ           ‚îú‚îÄ‚îÄ handler.go      # HTTP –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
‚îÇ           ‚îú‚îÄ‚îÄ router.go       # HTTP —Ä–æ—É—Ç–µ—Ä
‚îÇ           ‚îî‚îÄ‚îÄ middleware/
‚îÇ               ‚îú‚îÄ‚îÄ logger.go   # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îÇ               ‚îî‚îÄ‚îÄ rate_limiter.go # Rate limiting
‚îú‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ docker-compose.yaml
‚îú‚îÄ‚îÄ go.mod
‚îú‚îÄ‚îÄ go.sum
‚îú‚îÄ‚îÄ init.lua                    # Tarantool –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
‚îú‚îÄ‚îÄ Makefile                    # –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–æ–º
‚îî‚îÄ‚îÄ README.md
```

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### config/config.yaml
```yaml
app:
  name: "kv-storage"
  environment: "development"

http_server:
  port: "8080"
  read_timeout: 30s
  write_timeout: 30s

tarantool:
  host: "localhost"
  port: 3301
  username: "admin"
  password: "admin"
  timeout: 5s
```

#### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤ init.lua:
- **memtx_memory**: 1GB –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ –ø–∞–º—è—Ç–∏
- **checkpoint_interval**: 1 —á–∞—Å –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–Ω–∞–ø—à–æ—Ç–æ–≤
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞**: —Å—Ç–∞—Ä—ã–µ soft-deleted –∑–∞–ø–∏—Å–∏ —É–¥–∞–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ 30 –¥–Ω–µ–π

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏
–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å Zap:
- **Development**: –¶–≤–µ—Ç–Ω–æ–π –≤—ã–≤–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª—å
- **Production**: JSON —Ñ–æ—Ä–º–∞—Ç

### –ú–µ—Ç—Ä–∏–∫–∏
- HTTP –∑–∞–ø—Ä–æ—Å—ã/–æ—Ç–≤–µ—Ç—ã
- Latency
- Rate limiting —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- Connection pool —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

## –°—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞
```bash
# 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–µ–∫—Ç
git clone <repository-url>
cd kv-storage

# 2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –æ–∫—Ä—É–∂–µ–Ω–∏–µ
make dev-setup

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å
make dev
```

### –ü—Ä–æ–¥–∞–∫—à–Ω
```bash
# 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–µ–∫—Ç
git clone <repository-url>
cd kv-storage

# 2. –ó–∞–ø—É—Å—Ç–∏—Ç—å —á–µ—Ä–µ–∑ Docker
docker-compose up -d

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
docker-compose ps
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã
make test-all

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–æ–ª—å–∫–æ unit —Ç–µ—Å—Ç—ã
make test

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º
make test-coverage
```
